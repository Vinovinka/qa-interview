# Мобильное тестирование

### Какие мобильные ОС ты знаешь?
- iOS
- Android
- HarmonyOS

Устаревшие:
- Symbian
- Windows Phone
- Tizen
- Blackberry OS

### Зачем тестировать на реальных устройствах?

Дизайн элементов интерфейса в честном DPI, анимации UI на честной производительности модели, ограничения и пасхалки от производителя (оболочки Samsung, Xiaomi и тд), мониторинг потребления батареи при работе приложения, работа приложения с прерываниями (звонки), работа в фоне.

## Виды мобильных приложений
- Нативные - разрабатываются отдельно для каждой платформы и позволяют полностью использовать все возможности устройства.

Для разных операционных систем разработчики выбирают свой язык программирования. Для Android — Kotlin и Java, а для iOS — objC,Swift, SwiftUI.

- Веб-приложения - используются без специальной загрузки, в основном через браузер

- Гибридные 

## Типы мобильных приложений
- коммерческие
- социальные
- контентные
- игровые

## Особенности мобильного тестирования

Ориентация девайса (динамично меняется во время использования приложения), сенсорное взаимодействие с UI (важна область нажатия), ограниченные ресурсы (память, процессор, плохое соединение и т.д.), внешние прерывания (смс, звонок, пуши, блокировка девайса), наличие огромного количества устройств, с различными характеристиками и разрешениями экранов (из-за этого можно выявить девайсозависимые ошибки), исчерпываемая батарея, работа в фоне, частые обновления ОС.

## В чем разница между симулятором и эмулятором?

### Симулятор (Simulator)

**Определение**: Симулятор — это программный инструмент, который имитирует программную среду устройства. Он воспроизводит программное окружение (например, операционную систему), но не пытается воссоздать аппаратное обеспечение устройства.

**Использование**: 
- **iOS разработки**: Apple предоставляет симуляторы для тестирования приложений iOS через Xcode.
- **Поддержка приложения**: Симуляторы запускают приложения, скомпилированные для x86 архитектуры (как на Mac), а не для ARM архитектуры (как на реальных устройствах).

**Ограничения**:
- **Аппаратное обеспечение**: Симулятор не может воспроизводить низкоуровневое аппаратное поведение, такое как различные сенсоры (например, акселерометр), камера или GPS.
- **Производительность**: Поскольку симулятор запускается на архитектуре хоста (x86), он может отличаться по производительности от реального устройства на ARM.
- **Ограниченные возможности тестирования**: Не все функции, зависящие от конкретного оборудования, могут быть протестированы на симуляторе.

### Эмулятор (Emulator)

**Определение**: Эмулятор — это программный инструмент, который имитирует как программное, так и аппаратное окружение устройства. Он создаёт виртуальное окружение, максимально приближенное к реальному устройству, включая его архитектуру и аппаратные функции.

**Использование**:
- **Android разработки**: Android SDK предоставляет эмуляторы, которые эмулируют как операционную систему Android, так и аппаратное обеспечение устройства.

**Ограничения**:
- **Производительность**: Эмуляция может быть медленнее, так как она воспроизводит как программную, так и аппаратную часть устройства.
- **Совместимость**: Эмулятор предоставляет более точную среду для тестирования приложений, так как воспроизводит как программное, так и аппаратное окружение устройства.

### Ключевые различия

1. **Архитектура**:
   - **Симулятор**: Имитация только программной среды (чаще всего x86 архитектура).
   - **Эмулятор**: Воспроизведение как программной, так и аппаратной среды (ARM архитектура).

2. **Поддержка аппаратных функций**:
   - **Симулятор**: Ограниченная поддержка аппаратных функций, таких как сенсоры и GPS.
   - **Эмулятор**: Поддержка полного набора аппаратных функций устройства, включая сенсоры, камеру, GPS и т.д.

3. **Использование**:
   - **Симулятор**: Более подходит для быстрой разработки и тестирования приложений, не требующих специфичных аппаратных функций.
   - **Эмулятор**: Лучше подходит для более точного тестирования, особенно если нужно протестировать аппаратные функции или специфичное поведение устройства.

4. **Производительность**:
   - **Симулятор**: Обычно быстрее, так как работает на архитектуре хоста.
   - **Эмулятор**: Может быть медленнее из-за необходимости эмулировать аппаратную часть.

### Примеры

- **Симулятор iOS**: Используется для тестирования iOS приложений на Mac через Xcode. Он имитирует операционную систему iOS, но не аппаратные компоненты, такие как сенсоры.
- **Эмулятор Android**: Используется для тестирования Android приложений через Android SDK. Он эмулирует как операционную систему Android, так и аппаратные компоненты устройства.



## Что такое ADB
ADB (Android Debug Bridge) - клиент-серверное приложение, которое предоставляет доступ к работающему эмулятору или устройству. С его помощью можно копировать файлы, устанавливать скомпилированные программные пакеты и запускать консольные команды.
Состоит из трёх компонентов:

- фоновой службы (демона), работающей в эмуляторе
- сервиса, запущенного на компьютере разработчика
- клиентской программы (наподобие DDMS), которая связывается со службой через Сервис

Часто используемые команды: 

- adb devices покажет список устройств
- adb install target.apk установит приложение с bundleId "target.apk"
- adb uninstall target.apk удалит приложение
- adb -s deviceSerial обращение к конкретному устройству по его серийному номеру
- adb push / pull копирование файлов на / с телефона

## Как снять логи с iOS, Android?

*iOS*

Xcode - Devices and Simulators для информации из System Log 

Xcode - Debugger Area при локальной отладке

Developer Menu - Logs если добавлено разработчиком в конкретное приложение

*Android*

adb devices

adb -s <device ID> logcat -> log.log

Android Studio - при локальном запуске

## Как проверить функциональность на бою без раскатки на пользователей

Ограничение функционала на сервере и на клиенте, специально выделенные тестовые аккаунты с расширенным функционалом, секретное меню, установка новых версий по выделенным промокодам (iOS), фиче-тогглы.

## Что такое снифферы и зачем используются

Снифферы - это класс программ для перехвата, анализа и подмены трафика.

Популярные:

- Charles Proxy
- Proxyman 
- Wireshark
- MITM Proxy

Тестировщики используют в основном для подмен ответов от сервера для UI-тестов.

## Как определить список устройств для тестирования?

Необходимо отталкиваться от вводных условий и задать дополнительный вопрос - приложение новое или уже в проде, имеется аналитика аудитории, какой бюджет выделен на устройства, можно ли использовать фермы устройств. Дополнительно стоит уточнить поддержку планшетов и носимых девайсов (часы, браслеты).

Также стоит учесть, что ответ на вопрос подразумевает минимально достаточное количество девайсов для проверок. 

Если уже есть данные о пользователях и их девайсах, выделяем граничные значения + наиболее используемые девайс+ось, берем их. Плюс выбрать граничные значения по общей выборке популярных девайсов в странах-потребителях - минимально и максимально поддерживаемые версии OS в iOS и Android и девайсы, возможны пересечения. 

Если аналитики нет, то стоит взять минимально и максимально поддерживаемые OS (например, iOS 10 и iOS 17.5, Android 5 и Android 13) плюс девайсы по принципу "самый старый поддерживаемый, самый новый поддерживаемый, самый популярный". 

По девайсам стоит смотреть физический размер и разрешение экрана.

*iOS*

Самый маленький айфон (например, SE2 или 13 Mini) и самый большой по диагонали и разрешению айфон (например, iPhone 15 Pro Max) + самый популярные на рынке (например, iPhone 14). 
Взять девайс с touchID (например, уже попавший в выборку SE2), девайс "с челкой" - iPhone 11, c dymic island. Если к имеющимся девайсам добавить распределение по поддерживаемым iOS, выстроится общая картина списка девайсов. 

*Android*

Стоит взять в тест девайс с чистым андроидом (pixel), девайсы со специфическими оболочками (samsung, xiaomi), девайс без гугл-сервисов (huawei). Сюда же добавляем девайсы из списка популярных в регионе использования нашего приложения.
Если позволяет бюджет, берем также флагманы с нестандартным разрешщением экрана (samsing fold 2, flip3 либо motorola - раскладушки)

Далее делим девайсы по поддерживаемым версиям андроида и получаем список девайсов для тестирования.


## Что такое root/jailbreak

Джейлбрейк (англ. jailbreak) — официально не поддерживаемая корпорацией Apple операция, позволяющая получить доступ к файловой системе ряда моделей устройств iPhone, iPod, iPad, Apple TV и Apple Watch.

Позволяет расширить возможности аппарата, например, сделать возможным поддержку тем оформления, твиков и установку приложений из сторонних источников.

Рутинг (англ. Rooting) — процесс получения прав суперпользователя (root) на устройствах под управлением операционной системы Android или оболочек Android.

Основные цели рутинга:

- снятие ограничений производителя либо оператора связи
- манипулирование системными приложениями
- возможность запуска приложений, требующих прав администратора
- получение доступа к системным файлам

Устройство, прошедшее процесс рутинга, называется рутированным.

## Что такое гайдлайн, какие задачи решает
Гайдлайны мобильных систем — это набор правил для создания приложений, максимально удобных для пользователей разных платформ.

Это не ультимативные руководства, а список рекомендованных параметров, которые помогут пользователям эффективнее взаимодействовать с мобильным интерфейсом.

Гайдлайны описывают не только принципы UX, но и UI — они содержат рекомендации по шрифтам, цветам, вёрстке, анимации.

Существуют два главных гайдлайна для самых популярных операционных систем:

Google Material Design System — для Android.

Apple Human Interface Guidelines — для iOS.

## Где хранятся "чувствительные" данные приложения на iOS, Android
*iOS*

Keychain - пароли и другая чувствительная информация

NSUserDefaults - для настроек и пр.

iCloud - для настроек и данных

plist - настройки

SQLite / Core Data

*Android*

SharedPreferences - для настроек приложения и пр.

Account Manager - для аккаунтов и паролей

SQLite - все остальное

## Как защититься от атаки MiTM

Использовать безопасное соединение по протоколу HTTPS и SSL pinning. 

SSL pinning – это внедрение SSL сертификата, который используется на сервере, в код мобильного приложения. В этом случае приложение будет игнорировать хранилище сертификатов устройства, полагаясь только на свое хранилище и позволяя создать защищенное SSL соединение с хостом, подписанным только сертификатом, что хранится в самом приложении.

## Как проверить плохое соединение не выходя из офиса
iOS - Settings - Network Link Conditioner 

Android и остальные - локальный прокси с ограничением скорости

## В чем разница между AOSP и прошивкой от вендора

Android Open Source Project - это программный стек с открытым исходным кодом для мобильных устройств. Крупные производители модифицируют исходники Android и могут добавлять новые функции, менять вид ОС и тд.

## Профилирование iOS приложений на потребление CPU
Профилирование iOS-приложений на потребление CPU — это процесс анализа и оптимизации использования центрального процессора приложением с целью повышения производительности и энергоэффективности.

Основные шаги профилирования:

Сбор данных о потреблении ресурсов. Для этого можно использовать инструменты, встроенные в Xcode или сторонние инструменты.

Анализ полученных данных. Необходимо определить, какие функции или компоненты приложения потребляют больше всего ресурсов CPU. Это могут быть фоновые задачи, сетевые запросы, работа с графикой и т. д.

Оптимизация использования CPU. На основе анализа необходимо внести изменения в код приложения, чтобы уменьшить его нагрузку на процессор. 

Например, можно оптимизировать работу фоновых задач, уменьшить количество сетевых запросов, использовать более эффективные алгоритмы обработки данных и т. п.

Для профилирования потребления CPU iOS-приложения можно использовать следующие инструменты:

- Instruments
- Time Profiler
- Core Animation
- GPU Frame Capture
- Memory Monitor

## Профилирование Android приложений на потребление аккумулятора
Профилирование Android-приложений на потребление аккумулятора — это процесс анализа и оптимизации энергопотребления приложения с целью увеличения времени работы устройства от батареи.

Основные шаги профилирования:

Сбор данных о потреблении энергии приложением. Для этого можно использовать инструменты, встроенные в Android Studio или другие сторонние инструменты.

Анализ полученных данных. Необходимо определить, какие компоненты приложения потребляют больше всего энергии. Это могут быть фоновые службы, сетевые запросы, работа с графикой и т. д.

Оптимизация энергопотребления. На основе анализа необходимо внести изменения в код приложения, чтобы уменьшить его энергопотребление. Например, можно оптимизировать работу фоновых служб, уменьшить количество сетевых запросов, использовать более эффективные алгоритмы обработки данных и т. п.

Для профилирования энергопотребления Android-приложения можно использовать следующие инструменты:

- Android Studio Profiler
- Systrace
- Wakelock Detector
- LeakCanary
- Firebase Performance Monitoring

## .ipa пакет не устанавливается на все устройства. Твои дальнейшие действия и возможные причины

1. Проблемы с сертификатами. Проверить, что сертификаты разработки и распространения действительны и правильно настроены. 
Истек срок действия provisioning profile или он отсутствует. Необходимо в Xcode → Devices → Device Console найти логи демона "installd"

2. Ограничения App Store. Возможно, есть какие-то ограничения или ошибки в информации о приложении.

3. Конфликты с другими приложениями. Некоторые приложения могут конфликтовать друг с другом, вызывая проблемы при установке.

4. Ошибки в коде при сборке ipa-пакета

5. Некорректная/несовместимая версия iOS. Некоторые старые версии iOS могут не поддерживать новые функции или требования.

